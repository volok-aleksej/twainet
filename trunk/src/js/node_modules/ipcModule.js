var utils = require('twainetUtils');
var module = require('twainetModule');
var conn = require('ipcConnector');
var net = require('net');

exports.IPCModule = function(name, connector) {
	if(connector === undefined) {
		module.Module.call(this, name, conn.IPCConnector);
	} else {
		module.Module.call(this, name, connector);
	}

	this.moduleMap = {};
	this.ipcObjectMap = {};
}

utils.extend(exports.IPCModule, module.Module);

exports.IPCModule.prototype.addModuleName = function(name, options) {
	if(this.moduleMap[name] === undefined) {
		this.moduleMap[name] = options;
		return true;
	}
	return false;
}

exports.IPCModule.prototype.addIPCObject = function(name, options) {
	this.ipcObjectMap[name] = options;
}

exports.IPCModule.prototype.changeConnectorId = function(oldId, newId) {
	module.Module.prototype.changeConnectorId.call(this, oldId, newId);
	if(this.moduleMap[oldId] !== undefined) {
		var module = this.moduleMap[oldId];
		delete this.moduleMap[oldId];
		this.moduleMap[oldId] = module;
	}
}

exports.IPCModule.prototype.onDestroy = function(conn) {
	module.Module.prototype.onDestroy.call(this, conn);
	if(this.moduleMap[conn.id] !== undefined && this.connMap[conn.id] === undefined) {
		delete this.moduleMap[conn.id];
	}
	console.info(this.moduleMap);
}