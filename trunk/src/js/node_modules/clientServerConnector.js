var utils = require('twainetUtils');
var protobuf = require('protobufjs');
var conn = require('twainetConnector');

exports.ServerConnector = function(c, id) {
	var protoFilePath = "../messages/client_server.proto",
		self = this,
		protoMap = {},
		msgMap = {};

	conn.Connector.call(this, c, id);

	var handlers = function () {
	}
	handlers.prototype.Login = function(object) {
		console.info(object.get("name"));
		
		var resultCode = self.builder.build("client_server.ResultCode"),
			loginResult = self.builder.build("client_server.LoginResult"),
			myMessage = new loginResult(resultCode.LOGIN_SUCCESS, "cmaiofennmphjldldcpphcechfnnohja");
			self.sendMessage(myMessage);
	}

	this.builder = protobuf.loadProtoFile(protoFilePath);
	protoMap = this.builder.build();
	this.messageMap = {};
	msgMap = this.generateMap(protoMap, handlers.prototype);
	for(message in msgMap) if(msgMap.hasOwnProperty(message)){
		this.messageMap[message] = msgMap[message];
	}

	this.start();
};

utils.extend(exports.ServerConnector, conn.Connector);